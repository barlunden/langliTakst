---
import { getCollection } from "astro:content";

// Hent alle tenester
const tjenester = await getCollection("tjenester");

// getStaticPaths: Lag ei side for kvar unik categorySlug
export async function getStaticPaths() {
  const tjenester = await getCollection("tjenester");
  const categories = [...new Set(tjenester.map(t => t.data.categorySlug))];
  
  return categories.map(category => ({
    params: { category: String(category) } // Forsikre deg om at det er ein streng
  }));
}

// Hent valgt kategori frÃ¥ URL
const { category } = Astro.params;

// Filtrer tenester for denne kategorien
const filtered = tjenester.filter(t => t.data.categorySlug === category);

// Hent visningsnamn for kategorien
const categoryTitle = filtered.length > 0 ? filtered[0].data.category : category;
---
<html lang="no">
  <head>
    <title>{categoryTitle} | Tjenester | Langli Takst</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <main>
      <h1>{categoryTitle}</h1>
      {filtered.length === 0 ? (
        <p>Ingen tjenester funnet for denne kategorien.</p>
      ) : (
        <ul>
          {filtered.map(tjeneste => (
            <li>
              {tjeneste.data.image && (
                <img src={tjeneste.data.image} alt={tjeneste.data.title} width="200" />
              )}
              <h2>{tjeneste.data.title}</h2>
              <p>{tjeneste.data.description}</p>
            </li>
          ))}
        </ul>
      )}
    </main>
  </body>
</html>
